<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ฟอร์มลงทะเบียนสัมมนา</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap (optional, still used for grid) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa4b2;
      --accent1:#6ee7b7;
      --accent2:#60a5fa;
      --glass: rgba(255,255,255,0.04);
      --radius:16px;
    }

    html,body{height:100%;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body {
  background-image: url('https://picjumbo.com/wp-content/uploads/modern-futuristic-abstract-liquid-3d-lines-background-free-image.jpg'); /* เปลี่ยนเป็น URL รูปของคุณ */
  background-size: cover;        /* ทำให้ภาพเต็มหน้าจอ */
  background-position: center;   /* จัดให้อยู่ตรงกลาง */
  background-repeat: no-repeat;  /* ไม่ให้ภาพซ้ำ */
  background-attachment: fixed;  /* ภาพคงที่เวลา scroll */
  font-family: 'Poppins', sans-serif;
}

    .page {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:48px 20px;
    }

    .card-modern {
  background: rgba(0, 0, 0, 0.6); /* สีขาวโปร่งแสง */
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.2);
}


    @media (max-width: 900px){
      .card-modern{ grid-template-columns: 1fr; padding:20px; }
      .right-panel { order: -1; } /* show QR above on mobile */
    }

    .header {
      display:flex;
      align-items:center;
      gap:14px;
      margin-bottom:6px;
    }

    .brand-badge{
      width:52px;height:52px;border-radius:12px;
      background: linear-gradient(135deg,var(--accent1),var(--accent2));
      display:flex;align-items:center;justify-content:center;
      font-weight:700;color:#042027; font-size:18px;
      box-shadow: 0 6px 18px rgba(96,165,250,0.12);
    }

    h1.title {
      font-size:40px;
      margin:0;
      font-weight:600;
      color:#e7f0fb;
    }

    p.lead { margin:0; color:var(--muted); font-size:13px; }

    form .form-control{
      background: rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.04);
      color: #eaf6ff;
      border-radius:10px;
      padding:14px 14px;
      height:48px;
      box-shadow: inset 0 -1px 0 rgba(255,255,255,0.01);
    }

    .form-label{ font-size:16px; color:var(--muted); margin-bottom:6px; font-weight:500; }

    .btn-submit{
      background: linear-gradient(90deg,var(--accent2),var(--accent1));
      border:none;
      color:#042027;
      font-weight:700;
      padding:12px 18px;
      border-radius:12px;
      box-shadow: 0 8px 22px rgba(14,165,233,0.12);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .btn-submit:hover{ transform: translateY(-2px); box-shadow: 0 14px 36px rgba(14,165,233,0.14); }

    .muted-small{ color:var(--muted); font-size:16px; }

    /* right panel */
    .right-panel{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:18px;
      border:1px solid rgba(255,255,255,0.03);
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:stretch;
      min-height:220px;
      justify-content:flex-start;
    }

    .qr-box{
      background: var(--glass);
      border-radius:10px;
      padding:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:180px;
      border:1px dashed rgba(255,255,255,0.03);
    }

    .qr-box img { width:200px; height:200px; border-radius:8px; }

    .info-row{ display:flex; justify-content:space-between; gap:10px; align-items:center;}
    .small-key{ color:var(--muted); font-size:16px; }
    .small-val{ font-weight:600; color:#e6f6ff; }

    .note {
      font-size:16px; color:var(--muted); background: rgba(255,255,255,0.01); padding:10px; border-radius:8px;
    }

    .response {
      margin-top:12px;
      min-height:40px;
    }

  </style>
</head>
<body>
  <div class="page">
    <div class="card-modern">

      <!-- Left: Form -->
      <div>
        <div class="header">
          <div class="brand-badge">KPI</div>
          <div>
            <h1 class="title">ฟอร์มลงทะเบียนสัมมนา</h1>
            <p class="lead">กรอกข้อมูลด้านล่างเพื่อรับ QR Code ยืนยันการเข้าร่วมงาน</p>
          </div>
        </div>

        <form id="registerForm" class="mt-3">
          <div class="row g-3">
            <div class="col-12">
              <label for="fullname" class="form-label">ชื่อ-นามสกุล</label>
              <input type="text" id="fullname" name="fullname" class="form-control" required>
            </div>

            <div class="col-md-6">
              <label for="email" class="form-label">อีเมล</label>
              <input type="email" id="email" name="email" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label for="phone" class="form-label">เบอร์โทรศัพท์</label>
              <input type="tel" id="phone" name="phone" class="form-control">
            </div>

            <div class="col-12">
              <label for="organization" class="form-label">หน่วยงาน / บริษัท</label>
              <input type="text" id="organization" name="organization" class="form-control">
            </div>
          </div>

          <div class="d-flex align-items-center gap-3 mt-4">
            <button type="submit" class="btn btn-submit">ลงทะเบียนและรับ QR</button>
            <div class="muted-small">หรือสแกนหน้างานด้วย UID</div>
          </div>

          <div id="responseMessage" class="response"></div>
        </form>

        <div class="mt-4 note">
          <strong>หมายเหตุ:</strong> กรุณาตรวจสอบอีเมลเพื่อรับการยืนยัน (ระบบอาจส่งไปยังกล่อง Spam). ข้อมูลจะถูกบันทึกสำหรับการตรวจหน้างาน
        </div>
      </div>

      <!-- Right: QR preview + details -->
      <div class="right-panel">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div class="small-key">สถานะ</div>
            <div class="small-val" id="statusText">ยังไม่ได้ลงทะเบียน</div>
          </div>
          <div style="text-align:right">
            <div class="small-key">UID</div>
            <div class="small-val" id="uidText">-</div>
          </div>
        </div>

        <div class="qr-box" id="qrArea">
          <div class="muted-small">QR Code จะปรากฏที่นี่หลังลงทะเบียน</div>
        </div>

        <div class="info-row">
          <div>
            <div class="small-key">อีเมล</div>
            <div class="small-val" id="emailText">-</div>
          </div>
          <div>
            <div class="small-key">เบอร์</div>
            <div class="small-val" id="phoneText">-</div>
          </div>
        </div>

        <div style="margin-top:auto">
          <div class="muted-small">ต้องการดีไซน์หรือขนาดภาพอื่น ๆ แจ้งได้</div>
        </div>
      </div>

    </div>
  </div>

  <!-- bootstrap js (optional) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- your existing script (unchanged behavior) -->
  <script>
  // --- เปลี่ยนเป็น URL /exec ของคุณ ---
  const scriptURL = "https://script.google.com/macros/s/AKfycbx6DNkSTBuUEXuXHja2oYLt6DE_3K6k9VKNk8nKV9-YQBlxY8reaAP1lzmPjC4NWmYa/exec";

  const form = document.getElementById('registerForm');
  const responseMessage = document.getElementById('responseMessage');
  const qrArea = document.getElementById('qrArea');
  const statusText = document.getElementById('statusText');
  const uidText = document.getElementById('uidText');
  const emailText = document.getElementById('emailText');
  const phoneText = document.getElementById('phoneText');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    responseMessage.innerHTML = `<div class="alert alert-info p-2">กำลังลงทะเบียน... กรุณารอสักครู่</div>`;
    qrArea.innerHTML = `<div class="muted-small">กำลังสร้าง QR…</div>`;
    statusText.textContent = "กำลังประมวลผล...";
    uidText.textContent = "-";

    const fd = new FormData(form);

    try {
      const res = await fetch(scriptURL, { method: 'POST', body: fd });
      let data;
      const ct = res.headers.get('content-type') || '';
      if (ct.includes('application/json')) {
        data = await res.json();
      } else {
        const text = await res.text();
        try { data = JSON.parse(text); } catch { data = { success: (text === 'Success' || text.toLowerCase().includes('success')), raw: text }; }
      }

      if (data.success) {
        responseMessage.innerHTML = `<div class="alert alert-success p-2">✅ ลงทะเบียนสำเร็จแล้ว</div>`;
        statusText.textContent = "ลงทะเบียนแล้ว";
        uidText.textContent = data.uid || "-";
        emailText.textContent = form.email.value || "-";
        phoneText.textContent = form.phone.value || "-";

        // แสดง QR
        const qrUrl = data.qrUrl || (data.qr && (data.qr.startsWith('http') ? data.qr : "https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=" + encodeURIComponent(data.qr)));
        if (qrUrl) {
          qrArea.innerHTML = `<img src="${qrUrl}" alt="QR Code" style="width:200px;height:200px;border-radius:8px;">`;
        } else {
          qrArea.innerHTML = `<div class="muted-small">ไม่พบ QR</div>`;
        }

        form.reset();
      } else {
        responseMessage.innerHTML = `<div class="alert alert-danger p-2">❌ เกิดข้อผิดพลาด: ${data.message || JSON.stringify(data)}</div>`;
        statusText.textContent = "เกิดข้อผิดพลาด";
        qrArea.innerHTML = `<div class="muted-small">ไม่สามารถสร้าง QR</div>`;
      }

    } catch (err) {
      console.error(err);
      responseMessage.innerHTML = `<div class="alert alert-danger p-2">❌ เกิดข้อผิดพลาด (network): ${err.message}</div>`;
      statusText.textContent = "ข้อผิดพลาดเครือข่าย";
      qrArea.innerHTML = `<div class="muted-small">ไม่สามารถเชื่อมต่อ</div>`;
    }
  });
  </script>
</body>
</html>
