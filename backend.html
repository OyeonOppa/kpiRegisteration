<input type="text" id="uidInput" placeholder="พิมพ์ UID หรือสแกน QR" autofocus>
<video id="preview"></video>
<div id="result"></div>

<script src="https://unpkg.com/html5-qrcode@2.3.9/minified/html5-qrcode.min.js"></script>
<script>
const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbzTEM9RR8lPOiIL4u3Ypg_BZOFj_DScxojCjvtHTDhR3carVCAKew6obakc0SP513GknA/exec';
const uidInput = document.getElementById('uidInput');
const resultDiv = document.getElementById('result');

function checkIn(uid) {
  resultDiv.innerHTML = `<div class="alert alert-info">กำลังตรวจสอบ UID: ${uid}</div>`;
  fetch(`${BACKEND_URL}?uid=${encodeURIComponent(uid)}`)
    .then(res => res.json())
    .then(data => {
      if (data.success) resultDiv.innerHTML = `<div class="alert alert-success">✅ ${data.fullname} เช็คอินเรียบร้อยแล้ว</div>`;
      else resultDiv.innerHTML = `<div class="alert alert-danger">❌ ${data.message}</div>`;
    })
    .catch(err => resultDiv.innerHTML = `<div class="alert alert-danger">❌ เกิดข้อผิดพลาด: ${err}</div>`);
}

// พิมพ์ UID
uidInput.addEventListener('change', () => {
  const uid = uidInput.value.trim();
  if (uid) {
    checkIn(uid);
    uidInput.value = '';
  }
});

// สแกน QR
const html5QrcodeScanner = new Html5Qrcode("preview");
html5QrcodeScanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 },
  (decodedText) => checkIn(decodedText),
  (errorMessage) => console.warn(errorMessage)
).catch(err => console.error(err));
</script>
